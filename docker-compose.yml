version: "3.9"

services:
  rag:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - RAG_VECTORSTORE__BACKEND=qdrant
      - RAG_VECTORSTORE__COLLECTION=investment_docs
      - RAG_EMBEDDING__PROVIDER=ollama
      - RAG_EMBEDDING__MODEL=nomic-embed-text
      - RAG_LLM__PROVIDER=ollama
      - QDRANT_URL=http://qdrant:6333
      - OLLAMA_HOST=http://host.docker.internal:11434
    depends_on:
      - qdrant
    volumes:
      - ./local_data:/app/local_data

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage

  localstack:
    image: localstack/localstack:latest
    ports:
      - "4566:4566"
    environment:
      - SERVICES=s3,sqs
      - DEFAULT_REGION=us-east-1
    volumes:
      - localstack_data:/var/lib/localstack

volumes:
  qdrant_data:
  localstack_data:
